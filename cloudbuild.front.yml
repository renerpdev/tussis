steps:
  - name: 'gcr.io/cloud-builders/docker'
    args:
      [
        'build',
        '-t',
        'gcr.io/${_FIREBASE_PROJECT_ID}/firebase',
        './dockerfiles/firebase',
      ]

  # Install node deps
  - name: 'node:16.20'
    entrypoint: 'yarn'

  # Build/Deploy front-office
  - name: 'node:16.20'
    entrypoint: 'yarn'
    args: ['nx', 'deploy', 'front-office', '--token', '${_FIREBASE_TOKEN}']
    env:
      - 'VITE_API_URL=${_API_URL}'
      - 'VITE_FIREBASE_API_KEY=${_FIREBASE_API_KEY}'
      - 'VITE_FIREBASE_AUTH_DOMAIN=${_FIREBASE_AUTH_DOMAIN}'
      - 'VITE_FIREBASE_PROJECT_ID=${_FIREBASE_PROJECT_ID}'


timeout: 1200s
